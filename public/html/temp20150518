<% if(user) {%>
<div class="action-main-user-info" ng-controller="ActionUserInfoControl">
  <% include userinfo.ejs %>
</div>
<% }%>
<div class="action-main-child action-main-actions" ng-controller="ActionsInfoControl" >

  <% include actions.ejs %>

</div>
<% if(user) {%>
<div class="action-main-child" >
  22

</div>
<div class="action-main-child">
  33
</div>
<div class="action-main-child">
  44
</div>
<% } %>


<a href="/web/action/{{item._id}}">
<img ng-src="{{item.picture}}" class="md-card-img" />
<h3 class="title">{{item.name}}</h3>
<md-card-content>
  <md-list>
    <md-list-item class="md-3-line">
      <div class="md-list-item-text">
        <p>{{item.desc}}</p>

      </div>
    </md-list-item>
    <div hide-sm>
    <md-divider ></md-divider>
    <md-list-item>
      <div class="action-icon"><ng-md-icon  icon='access_time' style="fill: #ddd" size="28"></ng-md-icon></div>

        <ul class="md-list-item-text action-list-info-text">
          <li>
            <span class="left">{{item.start_date | date:' hh:mm'}}~{{item.end_date | date:' hh:mm'}}</span>
            <span class="right">{{item.timeDiff}}</span>
          </li>
          <li>
            <span class="left">{{item.EEEE}}</span>
            <span class="right">{{item.start_date | date:'yyyy'}}年{{item.start_date | date:' m'}}月{{item.start_date | date:'d'}}日</span>
          </li>
        </ul>

    </md-list-item>
    <md-divider ></md-divider>
    <md-list-item>
      <div class="action-icon"><ng-md-icon  icon='location_on' style="fill: #ddd" size="28"></ng-md-icon></div>

        <ul class="md-list-item-text action-list-info-text">
          <li>
            <span class="left">{{item.addr_name}}</span>
            <span class="right">距离这里</span>
          </li>
          <li>
            <span class="left">{{item.addr_name}}</span>
            <span class="right">{{item.distance}}</span>
          </li>
        </ul>

    </md-list-item>
    <md-divider ></md-divider>
    <md-list-item>
      <div class="action-icon"><ng-md-icon  icon='group' style="fill: #ddd" size="28"></ng-md-icon></div>

        <ul class="md-list-item-text action-list-info-text">
          <li>
            <span class="left">{{item.name}}</span>
            <span class="right">已参加</span>
          </li>
          <li>
            <span class="left">负责人</span>
            <span class="right">{{item.__v}}</span>
          </li>
        </ul>

    </md-list-item>

    <md-list-item>
      <div class="action-info-btn" layout="row">
        <md-button class="md-raised action-btn-default">我也要参加</md-button>
        <md-button class="md-raised">分享</md-button>
      </div>
    </md-list-item>
    </div>
    <div hid-gt-sm>
      <md-list-item>
        <div class="action-info-btn-m" layout="row">
          <md-button class="md-icon-button">分享</md-button>
          <md-button class="md-icon-button">加入</md-button>
          <md-button class="md-icon-button">{{item.__v}}</md-button>
        </div>
      </md-list-item>
    </div>
  </md-list>
</md-card-content>
</a>



<a class="test" ng-click="actionInfoShow($event)">
  <md-card   id="{{item._id}}" ng-repeat="item in action.actions" >
    <img ng-src="{{item.picture}}" class="md-card-img" />
    <h3 class="title">{{item.name}}</h3>
    <md-card-content>
      <md-list>
        <md-list-item class="md-3-line">
          <div class="md-list-item-text">
            <p>{{item.desc}}</p>

          </div>
        </md-list-item>
        <div hide-sm>
        <md-divider ></md-divider>
        <md-list-item>
          <div class="action-icon"><ng-md-icon  icon='access_time' style="fill: #ddd" size="28"></ng-md-icon></div>

            <ul class="md-list-item-text action-list-info-text">
              <li>
                <span class="left">{{item.start_date | date:' hh:mm'}}~{{item.end_date | date:' hh:mm'}}</span>
                <span class="right">{{item.timeDiff}}</span>
              </li>
              <li>
                <span class="left">{{item.EEEE}}</span>
                <span class="right">{{item.start_date | date:'yyyy'}}年{{item.start_date | date:' m'}}月{{item.start_date | date:'d'}}日</span>
              </li>
            </ul>

        </md-list-item>
        <md-divider ></md-divider>
        <md-list-item>
          <div class="action-icon"><ng-md-icon  icon='location_on' style="fill: #ddd" size="28"></ng-md-icon></div>

            <ul class="md-list-item-text action-list-info-text">
              <li>
                <span class="left">{{item.addr_name}}</span>
                <span class="right">距离这里</span>
              </li>
              <li>
                <span class="left">{{item.addr_name}}</span>
                <span class="right">{{item.distance}}</span>
              </li>
            </ul>

        </md-list-item>
        <md-divider ></md-divider>
        <md-list-item>
          <div class="action-icon"><ng-md-icon  icon='group' style="fill: #ddd" size="28"></ng-md-icon></div>

            <ul class="md-list-item-text action-list-info-text">
              <li>
                <span class="left">{{item.name}}</span>
                <span class="right">已参加</span>
              </li>
              <li>
                <span class="left">负责人</span>
                <span class="right">{{item.__v}}</span>
              </li>
            </ul>

        </md-list-item>

        <md-list-item>
          <div class="action-info-btn" layout="row">
            <md-button class="md-raised action-btn-default">我也要参加</md-button>
            <md-button class="md-raised">分享</md-button>
          </div>
        </md-list-item>
        </div>
        <div hid-gt-sm>
          <md-list-item>
            <div class="action-info-btn-m" layout="row">
              <md-button class="md-icon-button">分享</md-button>
              <md-button class="md-icon-button">加入</md-button>
              <md-button class="md-icon-button">{{item.__v}}</md-button>
            </div>
          </md-list-item>
        </div>
      </md-list>
    </md-card-content>
  </md-card>
</a>


{
    "_id": "5545e55ae0c2cf2819ffee44",
    "addr_name": "hnust",
    "creator": "5541bc88c95d59f1e8990a97",
    "__v": 0,
    "active": true,
    "top": false,
    "type_id": 1,
    "forkable": true,
    "unlike_count": 0,
    "like_count": 0,
    "visit_count": 0,
    "reply_count": 0,
    "addr_position_y": 2,
    "addr_position_x": 1,
    "desc": "desc",
    "edit_date": "2015-05-03T09:07:38.045Z",
    "end_date": "2015-05-04T09:07:38.000Z",
    "start_date": "2015-05-03T09:07:38.000Z",
    "create_date": "2015-05-03T09:07:38.045Z",
    "name": "test"
}




<md-input-container class="action-main-initiate-subject">
  <md-icon md-svg-src="/images/subject.svg"></md-icon>
  <input ng-model="user.email" type="text" placeholder="活动主题" ng-required="true">
</md-input-container>
<div class="action-main-initiate-type">

  <div class="title-type">
    <md-icon md-svg-src="/images/grain.svg"></md-icon>
    <span>活动类型</span>
  </div>
  <div class="child">
    <md-checkbox aria-label="饭局">
      饭局
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="KTV">
      KTV
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="电影">
      电影
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="桌游">
      桌游
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="网吧">
      网吧
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="露营">
      露营
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="公益">
      公益
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="探险">
      探险
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="旅行">
      旅行
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="咖啡">
      咖啡
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="自习">
      自习
    </md-checkbox>
  </div>
  <div class="child">
    <md-checkbox aria-label="南俱">
      南俱
    </md-checkbox>
  </div>
  <div style="clear:both;"></div>
</div>

<md-input-container flex>
  <label style="color:#ccc;">活动介绍</label>
  <textarea  columns="1" ></textarea>
</md-input-container>

<div class="action-main-initiate-map">
  <div class="title-type">
    <md-icon md-svg-src="/images/room.svg"></md-icon>
    <span>地点</span>
    <a href="#" class="md-primary md-icon-button" >
      Show as List
    </a>
  </div>

</div>
<div class="action-main-initiate-start-time">
  <div class="title-type">
    <md-icon md-svg-src="/images/access_time.svg"></md-icon>
    <span>开始时间</span>
  </div>
  <md-input-container flex>
    <label>Submission Date</label>
    <input type="date" >
  </md-input-container>
</div>
<div class="action-main-initiate-end-time">
  <div class="title-type">
    <md-icon md-svg-src="/images/access_time.svg"></md-icon>
    <span>结束时间</span>
  </div>
  <md-input-container flex>
    <label>Submission Date</label>
    <input type="date" >
  </md-input-container>
</div>


<div class="row">
  <span class="left">发起：</span>
  <span class="right"><%=creator_name%></span>
</div>
<div class="row">
  <span class="left">创建时间：</span>
  <span class="right"><%=action.create_date%></span>
</div>

function dateFomate(date,type){
  date.getYear(); //获取date年份(2位)
  date.getFullYear(); //获取完整的年份(4位,1970-????)
  date.getMonth(); //获取date月份(0-11,0代表1月)
  date.getDate(); //获取date日(1-31)
  date.getDay(); //获取date星期X(0-6,0代表星期天)
  date.getTime(); //获取date时间(从1970.1.1开始的毫秒数)
  date.getHours(); //获取date小时数(0-23)
  date.getMinutes(); //获取date分钟数(0-59)
  date.getSeconds(); //获取date秒数(0-59)
  date.getMilliseconds(); //获取date毫秒数(0-999)
  date.toLocaleDateString(); //获取date日期
  var itime=date.toLocaleTimeString(); //获取date时间
  date.toLocaleString( ); //获取日期与时间

  switch(type){
    case 'yyyymmdd':
     return date.getFullYear()+'年'+date.getMonth()+1+'月'+date.getDate()+'日';


  }


}


Date.prototype.format = function(format){
  var o = {
    "M+" : this.getMonth()+1, //month
    "d+" : this.getDate(), //day
    "h+" : this.getHours(), //hour
    "m+" : this.getMinutes(), //minute
    "s+" : this.getSeconds(), //second
    "q+" : Math.floor((this.getMonth()+3)/3), //quarter
    "S" : this.getMilliseconds() //millisecond
  }

  if(/(y+)/.test(format)) {
    format = format.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
  }

  for(var k in o) {
    if(new RegExp("("+ k +")").test(format)) {
      format = format.replace(RegExp.$1, RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
    }
  }
  return format;
}



<script>
  // 百度地图API功能
  var mapInfoX,mapInfoY;
  var map = new BMap.Map("actionMapIni");
  var point = new BMap.Point(116.331398,39.897445);
  var geoc = new BMap.Geocoder();
  map.centerAndZoom(point,12);


  var geolocation = new BMap.Geolocation();
  geolocation.getCurrentPosition(function(r){
  if(this.getStatus() == BMAP_STATUS_SUCCESS){
    var mk = new BMap.Marker(r.point);
    map.addOverlay(mk);
    map.panTo(r.point);
    console.log(r.point.lng,r.point.lat);
    point=new BMap.Point(r.point.lng,r.point.lat);
    setTimeout(function(){
      map.setZoom(14);
    }, 1000);
  }
  else {
    $('#mInfo').text('null');
  }
 },{enableHighAccuracy: true})

  // 添加带有定位的导航控件
  var navigationControl = new BMap.NavigationControl({
  // 靠左上角位置
  anchor: BMAP_ANCHOR_TOP_LEFT,
  // LARGE类型
  type: BMAP_NAVIGATION_CONTROL_LARGE,
  // 启用显示定位
    enableGeolocation: true
  });
  map.addControl(navigationControl);
  // 添加定位控件
  var geolocationControl = new BMap.GeolocationControl();


  geolocationControl.addEventListener("locationSuccess", function(e){
  // 定位成功事件
    var address = '';
    address += e.addressComponent.province;
    address += e.addressComponent.city;
    address += e.addressComponent.district;
    address += e.addressComponent.street;
    address += e.addressComponent.streetNumber;
    alert("当前定位地址为：" + address);
  });
  geolocationControl.addEventListener("locationError",function(e){
    // 定位失败事件
    alert(e.message);
  });
  var addr,x,y;
  var local = new BMap.LocalSearch(map, {
    renderOptions:{map: map},
    pageCapacity:5,
    onSearchComplete: function(results){
     // 判断状态是否正确
    if (local.getStatus() == BMAP_STATUS_SUCCESS){

        for (var i = 0; i < results.getCurrentNumPois(); i ++){
          $('#actionMapReuslt ul').append('<li><div class=" md-icon"><ng-md-icon icon="room" style="fill:#ddd" size="28"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="28" height="28"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg></ng-md-icon></div><span class="action-map-results-span" addx='+results.getPoi(i).point.lng+' addy='+results.getPoi(i).point.lat+'>'+results.getPoi(i).title+','+results.getPoi(i).address+'</span></li>');
              //+s.push(results.getPoi(i).title + ", " + results.getPoi(i).address+results.getPoi(i).point.lng+results.getPoi(i).point.lat)+'</md-radio-button>';
        }
            //document.getElementById("actionMapReuslt").innerHTML = s.join("<br/>");
        $('.action-map-results-span').click(function(){
          $('.action-position-search-input').val($(this).text()).trigger('focus');

          $('.addrx').val($(this).attr('addx'));
          $('.addry').val($(this).attr('addy'));
          //$('.action-position-search-input').attr('addx',$(this).attr('addx'))
          //$('.action-position-search-input').attr('addy',$(this).attr('addy'))
          //console.log($(this).attr('addx'));
          addr=$(this).text();
          x=$(this).attr('addx');
          y=$(this).attr('addy');

          console.log(addr);

        });


    }



    }
  });
  $('.action-map-results-span').click(function(){
    $('.action-position-search-input').val($(this).text());
    $('.addrx').val($(this).attr('addx'));
    $('.addry').val($(this).attr('addy'));
    //$('.action-position-search-input').attr('addx',$(this).attr('addx'))
    //$('.action-position-search-input').attr('addy',$(this).attr('addy'))
    //console.log($(this).attr('addx'));

  });
  $('.action-map-results-span').on();
  //console.log($('.action-map-results-span').length);
 //var local = new BMap.LocalSearch(map, options);
 //$('md-checkbox').click(function(){
    //local.searchInBounds($(this).text(), map.getBounds());
    //local.search($(this).text());
    //console.log($(this).text());
  //})

  //console.log($('.action-position-search-input').val());

  $('.action-position-search-input').bind('input propertychange',function(e){
    local.search($(this).val());
    //console.log($(this).val());

  });

  map.addControl(geolocationControl);
  map.addEventListener("click",function(e){
  //e.point.lng + "," + e.point.lat
  point=new BMap.Point(e.point.lng,e.point.lat);

  geoc.getLocation(e.point, function(rs){

     var addComp = rs.addressComponents;
     //$('.action-position-search-input').val(addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
     console.log($(this));
     //alert(e.point.lng + "," + e.point.lat+addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
  });


  });



</script>
